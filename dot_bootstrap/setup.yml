---
- name: Machine setup
  hosts: localhost
  become: true
  connection: local
  gather_facts: true
  #  vars:


  tasks:
    - name: Get my user
      ansible.builtin.set_fact:
        remote_regular_user: "{{ ansible_env.SUDO_USER or ansible_user_id }}"
    

    - name: Install system level packages
      xbps:
        name: 
          - void-repo-nonfree
          - booster 
        state: present


    - name: Install void packages
      xbps:
        name:
          - ansible
          - git
          - btop
          - vim
          - freerdp3
          - fzf
          - helix 
          - googler
          - rpi-imager
          - nsxiv
          - net-tools
          - fastfetch
          - timeshift
          - magic-wormhole
          - gparted
          - podman-compose
          - tar
          - curl
          - xz
          - binutils
        state: present 


    - name: Pull dockurr/windows image
      podman_image:   
        name: docker.io/dockurr/windows 

    - name: Pull dockur/windows image
      podman_image:
        name: docker.io/frooodle/s-pdf 
        tag: latest-fat
    
    - name: install surf browser repo
      ansible.builtin.git:
        repo: 'https://git.suckless.org/surf'
        dest: '/home/{{ remote_regular_user }}/suckless'

    - name: install void-package repo
      ansible.builtin.git:
        repo: 'https://github.com/void-linux/void-packages.git'
        dest: '/home/{{ remote_regular_user }}/void-packages'
        version: master

    - name: install winapps repo
      ansible.builtin.git:
        repo: 'https://github.com/winapps-org/winapps.git'
        dest: '/home/{{ remote_regular_user }}/winapps'
        version: main

    - name: install Stirling-PDF repo
      ansible.builtin.git:
        repo: 'https://github.com/Stirling-Tools/Stirling-PDF.git'
        dest: '/home/{{ remote_regular_user }}/Stirling-PDF'
        version: main

    - name: Download xdeb and set to executable
      ansible.builtin.get_url:
        url: 'https://github.com/xdeb-org/xdeb/releases/download/v1.5/xdeb'
        dest: '/usr/local/bin/'
        mode: '744'


#MAY NEED TO INSTALL DISTROBOX AS A .DEB, OR USE CURL

     -  name: Setup booster, move yamls, create pod-containers, and start Stirling on boot
        ansible.builtin.script: ~/{{ remote_regular_user }}/.scripts/setup.sh
        args:
          creates: '~/{{ remote_regular_user }}/winapps/compose.yaml'
          executable: /bin/bash
    







